<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartSort Notes AI</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <style>
        :root { --bg: #202124; --card: #303134; --text: #e8eaed; --accent: #fbbc04; --border: #5f6368; }
        body { background: var(--bg); color: var(--text); font-family: 'Google Sans', Roboto, sans-serif; padding: 20px; margin: 0; }
        
        /* --- The Input Area (Keep Style) --- */
        .input-wrapper {
            background: var(--bg);
            border-radius: 8px;
            padding: 5px;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.6);
            max-width: 600px;
            margin: 20px auto 40px auto;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            position: relative;
        }
        
        input {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            outline: none;
        }

        /* Action Buttons */
        .icon-btn {
            background: none;
            border: none;
            color: #9aa0a6;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: 0.2s;
        }
        .icon-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .icon-btn.recording { color: #f28b82; animation: pulse 1s infinite; }

        /* --- The Grid Layout --- */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        @media (max-width: 800px) { .grid { grid-template-columns: 1fr; } } 

        .column { background: transparent; padding: 10px; border-radius: 15px; }
        .col-header { 
            font-size: 12px; font-weight: bold; letter-spacing: 1px; 
            text-transform: uppercase; color: #9aa0a6; margin-bottom: 15px; 
            display: flex; align-items: center; gap: 5px;
        }

        /* --- Note Cards --- */
        .note { 
            background: var(--card); 
            padding: 15px; 
            margin-bottom: 10px; 
            border-radius: 8px; 
            border: 1px solid transparent; 
            transition: 0.2s;
            position: relative;
        }
        .note:hover { border-color: #9aa0a6; }
        
        .note-content { font-size: 14px; line-height: 1.4; white-space: pre-wrap; }
        
        .note-footer {
            margin-top: 10px;
            display: flex;
            justify-content: flex-end;
            opacity: 0; /* Hidden until hover */
            transition: 0.2s;
        }
        .note:hover .note-footer { opacity: 1; }
        
        .sm-btn { background: none; border: none; color: #9aa0a6; cursor: pointer; font-size: 16px; }
        .sm-btn:hover { color: #f28b82; }

        /* Category Colors (Subtle borders) */
        #col-todo .note { border-left: 3px solid #fbbc04; }
        #col-shopping .note { border-left: 3px solid #8ab4f8; }
        #col-ideas .note { border-left: 3px solid #ccff90; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        
        /* Loading Overlay */
        #loading { display: none; position: absolute; right: 60px; color: var(--accent); font-weight: bold; font-size: 14px; }
    </style>
</head>
<body>

    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; justify-content: center;">
        <span class="material-icons-outlined" style="color:var(--accent); font-size: 30px;">lightbulb</span>
        <h2 style="margin:0;">SmartSort Notes</h2>
    </div>

    <div class="input-wrapper">
        <input type="text" id="userInput" placeholder="Type or speak... (e.g., 'Buy milk and eggs')">
        <span id="loading">AI Sorting...</span>
        
        <button class="icon-btn" onclick="toggleVoice()" id="micBtn" title="Speak">
            <span class="material-icons-outlined">mic</span>
        </button>
        
        <button class="icon-btn" onclick="addSmartNote()" title="Add Note">
            <span class="material-icons-outlined">send</span>
        </button>
    </div>

    <div class="grid">
        <div class="column" id="col-todo">
            <div class="col-header"><span class="material-icons-outlined">check_circle</span> Tasks & Todo</div>
            <div id="list-todo"></div>
        </div>

        <div class="column" id="col-shopping">
            <div class="col-header"><span class="material-icons-outlined">shopping_cart</span> Shopping</div>
            <div id="list-shopping"></div>
        </div>

        <div class="column" id="col-ideas">
            <div class="col-header"><span class="material-icons-outlined">emoji_objects</span> Ideas & Thoughts</div>
            <div id="list-ideas"></div>
        </div>
    </div>

    <script>
        // --- VOICE RECOGNITION SETUP ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('userInput').value = transcript;
                stopVoice();
                // Optional: Auto-submit after speaking
                // addSmartNote(); 
            };
            recognition.onerror = (event) => { stopVoice(); console.log("Voice error", event); };
        } else {
            console.log("Browser does not support voice");
            document.getElementById('micBtn').style.display = 'none';
        }

        function toggleVoice() {
            const btn = document.getElementById('micBtn');
            if (btn.classList.contains('recording')) {
                stopVoice();
            } else {
                startVoice();
            }
        }

        function startVoice() {
            if(recognition) {
                recognition.start();
                document.getElementById('micBtn').classList.add('recording');
                document.getElementById('userInput').placeholder = "Listening...";
            }
        }

        function stopVoice() {
            if(recognition) {
                recognition.stop();
                document.getElementById('micBtn').classList.remove('recording');
                document.getElementById('userInput').placeholder = "Type or speak...";
            }
        }

        // --- APP LOGIC ---
        async function loadNotes() {
            const res = await fetch('/get_notes');
            const data = await res.json();
            
            ['todo', 'shopping', 'ideas'].forEach(cat => {
                const list = document.getElementById(`list-${cat}`);
                list.innerHTML = '';
                data[cat].forEach(note => {
                    // Create checkbox style text if needed, for now simple text
                    list.innerHTML += `
                        <div class="note">
                            <div class="note-content">${note.text}</div>
                            <div class="note-footer">
                                <button class="sm-btn" onclick="deleteNote('${note.id}', '${cat}')">
                                    <span class="material-icons-outlined">delete</span>
                                </button>
                            </div>
                        </div>`;
                });
            });
        }

        async function addSmartNote() {
            const input = document.getElementById('userInput');
            const text = input.value;
            if (!text) return;

            document.getElementById('loading').style.display = 'block';

            await fetch('/add_note', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({text: text})
            });

            document.getElementById('loading').style.display = 'none';
            input.value = '';
            loadNotes();
        }

        async function deleteNote(id, category) {
            await fetch('/delete_note', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id: id, category: category})
            });
            loadNotes();
        }

        // Load initially
        loadNotes();
    </script>
</body>
</html>
