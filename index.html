<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sarthak 2.0 // NEXUS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020617;
            --surface: rgba(15, 23, 42, 0.7);
            --border: rgba(255, 255, 255, 0.08);
            --accent: #38bdf8;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --text: #f1f5f9;
            --text-dim: #64748b;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background: var(--bg);
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 80%);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }

        .interface {
            width: 100%;
            max-width: 600px;
            background: var(--surface);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 50px -10px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 850px;
        }

        /* HEADER */
        .header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.2);
        }

        .brand h1 { margin: 0; font-size: 1.1rem; font-weight: 700; letter-spacing: -0.5px; }
        .brand span { font-size: 0.7rem; color: var(--accent); font-family: 'JetBrains Mono'; letter-spacing: 1px; }

        .system-status {
            font-family: 'JetBrains Mono';
            font-size: 0.7rem;
            color: var(--success);
            background: rgba(16, 185, 129, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        /* INPUT AREA */
        .controls { padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        .input-row { display: flex; gap: 10px; }
        
        input[type="text"] {
            flex: 1;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            padding: 12px;
            border-radius: 10px;
            color: white;
            font-family: 'JetBrains Mono';
        }

        .options-row { display: flex; gap: 10px; }
        
        select {
            background: #0f172a;
            color: var(--text);
            border: 1px solid var(--border);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            flex: 1;
        }

        button.add-btn {
            background: var(--accent);
            color: #000;
            border: none;
            padding: 0 20px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
        }

        /* TASK LIST */
        .task-list {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .task-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid transparent;
            padding: 14px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
        }

        .task-card.done { opacity: 0.5; background: rgba(0,0,0,0.2); }
        .task-card.done .task-text { text-decoration: line-through; color: var(--text-dim); }

        .checkbox {
            width: 20px; height: 20px;
            border: 2px solid var(--text-dim);
            border-radius: 6px;
            cursor: pointer;
            display: grid; place-items: center;
        }
        .task-card.done .checkbox { border-color: var(--success); background: rgba(16, 185, 129, 0.2); }
        .task-card.done .checkbox::after { content: '✓'; color: var(--success); font-size: 14px; font-weight: bold; }

        .task-content { flex: 1; overflow: hidden; }
        
        .task-meta {
            display: flex; gap: 8px; margin-bottom: 4px; font-size: 0.7rem; font-family: 'JetBrains Mono';
        }

        .badge { padding: 2px 6px; border-radius: 4px; background: rgba(255,255,255,0.1); }
        .badge.high { color: var(--danger); background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); }
        .badge.med { color: var(--warning); background: rgba(245, 158, 11, 0.1); }
        
        .task-text { font-size: 0.95rem; line-height: 1.4; }

        .delete-btn {
            background: transparent; border: none; color: var(--text-dim);
            cursor: pointer; padding: 8px; font-size: 1.2rem;
        }
        .delete-btn:hover { color: var(--danger); }

        /* FOOTER */
        .footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            font-size: 0.75rem;
            color: var(--text-dim);
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.3);
        }

        /* LOADERS */
        .loader-bar { height: 2px; width: 100%; background: linear-gradient(90deg, transparent, var(--accent), transparent); position: absolute; top: 0; display: none; animation: load 1s infinite; }
        @keyframes load { 0% {transform: translateX(-100%)} 100% {transform: translateX(100%)} }
    </style>
</head>
<body>

    <div class="interface">
        <div class="loader-bar" id="loader"></div>

        <div class="header">
            <div class="brand">
                <h1>Sarthak 2.0</h1>
                <span>SYSTEM UPGRADE COMPLETE</span>
            </div>
            <div class="system-status" id="status">OFFLINE</div>
        </div>

        <div class="controls">
            <div class="input-row">
                <input type="text" id="taskInput" placeholder="Enter new directive...">
            </div>
            <div class="options-row">
                <select id="catSelect">
                    <option value="General">General</option>
                    <option value="Code">Code</option>
                    <option value="Study">Study</option>
                    <option value="Fitness">Fitness</option>
                </select>
                <select id="prioSelect">
                    <option value="Normal">Normal Priority</option>
                    <option value="High">High Priority</option>
                    <option value="Low">Low Priority</option>
                </select>
                <button class="add-btn" onclick="addTask()">ADD</button>
            </div>
        </div>

        <div class="task-list" id="list">
            </div>

        <div class="footer">
            <span id="stats">0 Active / 0 Total</span>
            <span>AUTO-RESET: ON</span>
        </div>
    </div>

<script>
    // URL
    const API_URL = "https://sarthak-tasks-backend.onrender.com";

    const dom = {
        input: document.getElementById('taskInput'),
        cat: document.getElementById('catSelect'),
        prio: document.getElementById('prioSelect'),
        list: document.getElementById('list'),
        loader: document.getElementById('loader'),
        status: document.getElementById('status'),
        stats: document.getElementById('stats')
    };

    document.addEventListener('DOMContentLoaded', () => {
        loadTasks();
        dom.input.addEventListener('keydown', e => e.key === 'Enter' && addTask());
    });

    async function loadTasks() {
        toggleLoader(true);
        dom.status.innerText = "SYNCING...";
        dom.status.style.color = "#fbbf24"; // Warning color

        try {
            const res = await fetch(`${API_URL}/tasks`);
            if(!res.ok) throw new Error("Server Error");
            const tasks = await res.json();
            
            render(tasks);
            dom.status.innerText = "ONLINE";
            dom.status.style.color = "#10b981"; // Success color
        } catch (err) {
            console.error(err);
            dom.status.innerText = "OFFLINE";
            dom.status.style.color = "#ef4444"; // Danger color
            dom.list.innerHTML = `<div style="text-align:center; padding:20px; color:#64748b">Unable to connect to Sarthak Backend.<br>Render server might be sleeping.</div>`;
        } finally {
            toggleLoader(false);
        }
    }

    async function addTask() {
        const text = dom.input.value.trim();
        if(!text) return;

        toggleLoader(true);
        const payload = {
            task: text,
            category: dom.cat.value,
            priority: dom.prio.value
        };

        try {
            await fetch(`${API_URL}/add`, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(payload)
            });
            dom.input.value = "";
            loadTasks();
        } catch(err) {
            alert("Failed to add task");
        } finally {
            toggleLoader(false);
        }
    }

    async function toggleTask(index) {
        // Optimistic UI update (feels faster)
        const card = document.getElementById(`task-${index}`);
        card.classList.toggle('done');
        
        try {
            await fetch(`${API_URL}/toggle/${index}`, { method: "POST" });
            loadTasks(); // Sync specifically to update stats
        } catch(err) {
            console.error("Toggle failed");
            loadTasks(); // Revert on error
        }
    }

    async function deleteTask(index) {
        if(!confirm("Terminate this task?")) return;
        toggleLoader(true);
        try {
            await fetch(`${API_URL}/delete/${index}`, { method: "DELETE" });
            loadTasks();
        } catch(err) {
            alert("Delete failed");
        } finally {
            toggleLoader(false);
        }
    }

    function render(tasks) {
        dom.list.innerHTML = "";
        
        const activeCount = tasks.filter(t => !t.done).length;
        dom.stats.innerText = `${activeCount} PENDING / ${tasks.length} TOTAL`;

        if(tasks.length === 0) {
            dom.list.innerHTML = `<div style="text-align:center; padding:30px; color:#64748b; font-size:0.9rem;">System Idle. No directives found.</div>`;
            return;
        }

        tasks.forEach((t, i) => {
            const isDone = t.done ? 'done' : '';
            const isHigh = t.priority === 'High' ? 'high' : t.priority === 'Normal' ? 'med' : 'low';
            
            const html = `
                <div class="task-card ${isDone}" id="task-${i}">
                    <div class="checkbox" onclick="toggleTask(${i})"></div>
                    <div class="task-content">
                        <div class="task-meta">
                            <span class="badge ${isHigh}">${t.priority.toUpperCase()}</span>
                            <span class="badge">${t.category.toUpperCase()}</span>
                            <span style="color:#64748b">${t.timestamp || ''}</span>
                        </div>
                        <div class="task-text">${escapeHtml(t.text)}</div>
                    </div>
                    <button class="delete-btn" onclick="deleteTask(${i})">×</button>
                </div>
            `;
            dom.list.insertAdjacentHTML('beforeend', html);
        });
    }

    function toggleLoader(show) {
        dom.loader.style.display = show ? 'block' : 'none';
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>
</body>
</html>
